#!/bin/sh
#
# Start read all files
#
REG_FAILURE_COUNT="0x104083FC"

clear_failure_count () {
  devmem $REG_FAILURE_COUNT 32 0
}

case "$1" in
  start)
    (
      echo "Starting"
      nice -n 19 readallfiles -q / &&
      clear_failure_count
    ) 2>&1 | logger -t readall &
    ;;
  stop)
    pkillwait -x readallfiles
    ;;
  restart|reload)
    $0 stop; $0 start
    ;;
  *)
    echo "Usage: $0 {start|stop|restart}" >&2
    exit 1
esac
