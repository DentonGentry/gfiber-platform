#!/bin/sh

usage() {
  echo "Usage: fccwifi [-b (a | b)] [-s ssid] [-c <crypto>]"
  echo "  where -b specifies the band (a=5GHz, b=2.4GHz),"
  echo "  -s supplies the ssid, and -c is the security setting"
  echo "  (WPA_PSK_AES, WPA2_PSK_AES, WPA_PSK_TKIP, WPA2_PSK_TKIP,"
  echo "  WEP, or NONE)."
  exit 1
}

band=a
crypto=WPA_PSK_AES
ssid=TestWifi

while getopts ":b:c:s:" opt
do
  case $opt in
    b) band=${OPTARG};;
    c) crypto=${OPTARG};;
    s) ssid=${OPTARG};;
  esac
done

if [ $band != a ] && [ $band != b ]; then
  usage
fi

if [ $crypto = WPA_PSK_AES ] ; then
  wl radio on
  wl down
  wl ap 1
  wl band $band
  wl auth 0
  wl infra 1
  wl wsec 4
  wl sup_wpa 1
  wl wpa_auth 4
  wl up
  wl set_pmk 1234567890
  wl ssid $ssid
  wl status
elif [ $crypto = WPA2_PSK_AES ] ; then
  wl radio on
  wl down
  wl ap 1
  wl band $band
  wl auth 0
  wl infra 1
  wl wsec 4
  wl sup_wpa 1
  wl wpa_auth 128
  wl up
  wl set_pmk 1234567890
  wl ssid $ssid
elif [ $crypto = WPA_PSK_TKIP ] ; then
  wl radio on
  wl down
  wl ap 1
  wl band $band
  wl auth 0
  wl infra 1
  wl wsec 2
  wl sup_wpa 1
  wl wpa_auth 4
  wl up
  wl set_pmk 1234567890
  wl ssid $ssid
elif [ $crypto = WPA2_PSK_TKIP ] ; then
  wl radio on
  wl down
  wl ap 1
  wl band $band
  wl auth 0
  wl infra 1
  wl wsec 2
  wl sup_wpa 1
  wl wpa_auth 128
  wl up
  wl set_pmk  1234567890
  wl ssid $ssid
elif [ $crypto = WEP ] ; then
  wl radio on
  wl down
  wl ap 1
  wl band $band
  wl auth 0
  wl infra 1
  wl wsec 1
  wl sup_wpa 1
  wl wpa_auth 0
  wl up
  wl ssid $ssid
  wl addwep 0 1234567890
elif [ $crypto = NONE ] ; then
  wl radio on
  wl down
  wl ap 1
  wl band $band
  wl auth 0
  wl infra 1
  wl wsec 0
  wl sup_wpa 1
  wl wpa_auth 0
  wl up
  wl ssid $ssid
else
  usage
fi

exit 0
